<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Monstache Team">
        <link rel="canonical" href="https://rwynn.github.io/monstache-site/start/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Getting Started - Monstache</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css">
        <link href="../css/extra.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-113057322-1', 'rwynn.github.io');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Monstache</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Getting Started</a>
                            </li>
                            <li class="navitem">
                                <a href="../config/" class="nav-link">Configuration</a>
                            </li>
                            <li class="navitem">
                                <a href="../advanced/" class="nav-link">Advanced</a>
                            </li>
                            <li class="navitem">
                                <a href="../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../config/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/rwynn/monstache-site/edit/master/src/start.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#getting-started" class="nav-link">Getting Started</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#installation" class="nav-link">Installation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#which-version-should-i-use" class="nav-link">Which version should I use?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#usage" class="nav-link">Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>Monstache is just a single binary without dependencies on runtimes like Ruby, Python or PHP. Monstache is written in
Go but you don't need to install the Go language unless you decide to write your own Go plugins.</p>
<p>If you simply want to run Monstache you just need to <a href="https://github.com/rwynn/monstache/releases">download the latest version</a>.</p>
<h2 id="which-version-should-i-use">Which version should I use?<a class="headerlink" href="#which-version-should-i-use" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Monstache version</th>
<th>Git branch (used to build plugin)</th>
<th>Docker tag</th>
<th>Description</th>
<th>Elasticsearch</th>
<th>MongoDB</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
<td>rel6</td>
<td>rel6, latest</td>
<td>MongoDB, Inc. go driver</td>
<td>Version 7+</td>
<td>Version 2.6+</td>
<td>Supported</td>
</tr>
<tr>
<td>5</td>
<td>rel5</td>
<td>rel5</td>
<td>MongoDB, Inc. go driver</td>
<td>Version 6</td>
<td>Version 2.6+</td>
<td>Supported</td>
</tr>
<tr>
<td>4</td>
<td>master</td>
<td>rel4</td>
<td>mgo community go driver</td>
<td>Version 6</td>
<td>Version 3</td>
<td>Deprecated</td>
</tr>
<tr>
<td>3</td>
<td>rel3</td>
<td>rel3</td>
<td>mgo community go driver</td>
<td>Versions 2 and 5</td>
<td>Version 3</td>
<td>Deprecated</td>
</tr>
</tbody>
</table>
<p>Unzip the download and adjust your PATH variable to include the path to the folder for your platform.</p>
<p>Let's make sure Monstache is set up as expected. You should see a similar version number in your terminal:</p>
<pre><code class="sh">monstache -v
# 6.7.4
</code></pre>

<p>You can also build monstache from source. Monstache uses <a href="https://github.com/golang/go/wiki/Modules">vgo</a>. </p>
<pre><code class="sh">cd ~/build # somewhere outside your $GOPATH
git clone https://github.com/rwynn/monstache.git
cd monstache
git checkout &lt;branch-or-tag-to-build&gt;
go install
# monstache binary should now be in $GOPATH/bin
</code></pre>

<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Monstache uses the MongoDB <a href="https://docs.mongodb.com/manual/core/replica-set-oplog/">oplog</a> as an event source. You will need to ensure
that MongoDB is configured to produce an oplog by <a href="http://docs.mongodb.org/manual/tutorial/deploy-replica-set/">deploying a replica set</a>.
If you haven't already done so, follow the 5 step <a href="https://docs.mongodb.com/manual/tutorial/deploy-replica-set/#procedure">procedure</a> 
to initiate and validate your replica set. For local testing your replica set may contain a 
<a href="https://docs.mongodb.com/manual/tutorial/convert-standalone-to-replica-set/">single member</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have enabled security in MongoDB you will need to give the user in your connection string
certain privileges:</p>
<p>For MongoDB versions prior to 3.6 the user in the connection string will need to be able read the <code>local</code> database (to read from the oplog) and any user databases that you wish to synch data from.</p>
<p>When using the resume or clustering features the user will need to be able to write to and 
create indexes for the <code>monstache</code> database, or more generally, whatever you configure the 
option <code>config-database-name</code> to be.</p>
<p>When using change streams you will need to implement the changes in the documentation for
<a href="https://docs.mongodb.com/manual/changeStreams/#access-control">access control</a>. Monstache
defaults to opening the change stream against the entire deployment.</p>
</div>
<p>Without any explicit configuration monstache will connect to Elasticsearch and MongoDB on localhost
on the default ports and begin tailing the MongoDB oplog.  Any changes to MongoDB while Monstache is running will be reflected in Elasticsearch.</p>
<p>To see the indexes created by Monstache you may want to issue the following command which will show the indices in Elasticsearch. By default, the
index names will match the db.collection name in MongoDB.</p>
<pre><code class="sh">
curl localhost:9200/_cat/indices?v

</code></pre>

<p>Monstache uses the <a href="https://github.com/toml-lang/toml">TOML</a> format for its configuration.  You can run 
monstache with an explicit configuration by passing the -f flag.</p>
<pre><code class="sh">monstache -f /path/to/config.toml
</code></pre>

<p>The following shows how to specify options in a TOML config file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is highly recommended that you start with only your MongoDB and Elasticsearch connection settings and only specify additional options as needed. </p>
</div>
<pre><code># connection settings

# connect to MongoDB using the following URL
mongo-url = &quot;mongodb://someuser:password@localhost:40001&quot;
# connect to the Elasticsearch REST API at the following node URLs
elasticsearch-urls = [&quot;https://es1:9200&quot;, &quot;https://es2:9200&quot;]

# frequently required settings

# if you need to seed an index from a collection and not just listen and sync changes events
# you can copy entire collections or views from MongoDB to Elasticsearch
direct-read-namespaces = [&quot;mydb.mycollection&quot;, &quot;db.collection&quot;, &quot;test.test&quot;, &quot;db2.myview&quot;]

# if you want to use MongoDB change streams instead of legacy oplog tailing use change-stream-namespaces
# change streams require at least MongoDB API 3.6+
# if you have MongoDB 4+ you can listen for changes to an entire database or entire deployment
# in this case you usually don't need regexes in your config to filter collections unless you target the deployment.
# to listen to an entire db use only the database name.  For a deployment use an empty string.
change-stream-namespaces = [&quot;mydb.mycollection&quot;, &quot;db.collection&quot;, &quot;test.test&quot;]

# additional settings

# if you don't want to listen for changes to all collections in MongoDB but only a few
# e.g. only listen for inserts, updates, deletes, and drops from mydb.mycollection
# this setting does not initiate a copy, it is only a filter on the change event listener
namespace-regex = '^mydb\.mycollection$'
# compress requests to Elasticsearch
gzip = true
# generate indexing statistics
stats = true
# index statistics into Elasticsearch
index-stats = true
# use the following user name for Elasticsearch basic auth
elasticsearch-user = &quot;someuser&quot;
# use the following password for Elasticsearch basic auth
elasticsearch-password = &quot;somepassword&quot;
# use 4 go routines concurrently pushing documents to Elasticsearch
elasticsearch-max-conns = 4 
# use the following PEM file to connections to Elasticsearch
elasticsearch-pem-file = &quot;/path/to/elasticCert.pem&quot;
# validate connections to Elasticsearch
elastic-validate-pem-file = true
# propogate dropped collections in MongoDB as index deletes in Elasticsearch
dropped-collections = true
# propogate dropped databases in MongoDB as index deletes in Elasticsearch
dropped-databases = true
# do not start processing at the beginning of the MongoDB oplog
# if you set the replay to true you may see version conflict messages
# in the log if you had synced previously. This just means that you are replaying old docs which are already
# in Elasticsearch with a newer version. Elasticsearch is preventing the old docs from overwriting new ones.
replay = false
# resume processing from a timestamp saved in a previous run
resume = true
# do not validate that progress timestamps have been saved
resume-write-unsafe = false
# override the name under which resume state is saved
resume-name = &quot;default&quot;
# use a custom resume strategy (tokens) instead of the default strategy (timestamps)
# tokens work with MongoDB API 3.6+ while timestamps work only with MongoDB API 4.0+
resume-strategy = 1
# exclude documents whose namespace matches the following pattern
namespace-exclude-regex = '^mydb\.ignorecollection$'
# turn on indexing of GridFS file content
index-files = true
# turn on search result highlighting of GridFS content
file-highlighting = true
# index GridFS files inserted into the following collections
file-namespaces = [&quot;users.fs.files&quot;]
# print detailed information including request traces
verbose = true
# enable clustering mode
cluster-name = 'apollo'
# do not exit after full-sync, rather continue tailing the oplog
exit-after-direct-reads = false
</code></pre>

<p>See <a href="../config/">Configuration</a> for details about each configuration
option.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2016 Ryan Wynn</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
